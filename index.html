<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web Test Booking DPbot</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #1e1e2e; margin: 0; font-family: 'Poppins', sans-serif; padding: 20px; user-select: none; }
        .main-container, .step-card { width: 100%; max-width: 420px; }
        .step-card { background: #2a2a3a; border-radius: 12px; padding: 20px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); border: 1px solid #4c4c6a; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s ease; }
        .countdown-container { text-align: center; font-size: 28px; color: #f38ba8; font-weight: bold; letter-spacing: 2px; margin-bottom: 15px; }
        button { border-radius: 8px; border: none; padding: 10px 16px; font-weight: bold; cursor: pointer; transition: all 0.2s ease; font-family: 'Poppins', sans-serif; font-size: 1rem; }
        button:disabled { cursor: not-allowed; opacity: 0.5; }
        button.register { color: #fff; background: linear-gradient(45deg, #5e72e4, #825ee4); }
        button.register:not(:disabled):hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(94, 114, 228, 0.4); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background-color: #1e293b; color: white; margin: 80px auto; padding: 24px 20px; border-radius: 16px; width: 90%; max-width: 420px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); position: relative; animation: slideUp 0.3s ease; }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 12px; display: block; text-align: center; color: #a6adc8; }
        .modal .close { position: absolute; top: 12px; right: 16px; font-size: 24px; color: #7f849c; cursor: pointer; }
        .branchButtons { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        .branch-item { background: #334155; color: #a0aec0; }
        .branch-item.selected { background-color: #a6e3a1; color: #1e1e2e; }
        .branch-item.unavailable { background-color: #f38ba8; color: white; cursor: not-allowed; opacity: 0.7; }
        #cloudflare-simulation { display:none; align-items: center; justify-content: center; padding: 20px; background-color: #2d3748; border-radius: 8px; margin: 20px 0; }
        .spinner { width: 24px; height: 24px; border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: #89b4fa; border-radius: 50%; animation: spin 1s linear infinite; }
        #bot-required-overlay { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #f56565; font-size: 24px; font-weight: bold; text-align: center; }
        .scene { width: 250px; height: 250px; perspective: 1200px; margin: 20px auto; position: relative; }
        #object3d { width: 100%; height: 100%; position: absolute; top: 0; left: 0; transform-style: preserve-3d; pointer-events: none; }
        #captcha-canvas { width: 100%; height: 100%; position: absolute; top:0; left:0; cursor: grab; z-index: 2; }
        #captcha-canvas:active { cursor: grabbing; }
        .face { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; border-radius: 10px; overflow: hidden; backface-visibility: hidden; }
        .front img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
        #captcha-status { margin-top: 15px; font-size: 1.2em; font-weight: bold; height: 30px; transition: color 0.5s ease; }
        .success { color: #a6e3a1; }
        .failure { color: #f38ba8; }
        #loadingCaptcha { position: fixed; inset: 0; background-color: #11111b; display: none; flex-direction: column; justify-content: center; align-items: center; color: #fff; font-size: 1.5em; font-weight: bold; z-index: 1001; }
        .loading-bar-container { width: 80%; margin: 15px auto 0; background-color: #45475a; border-radius: 5px; height: 8px; overflow: hidden; }
        .loading-bar { width: 0%; height: 100%; background-color: #a6e3a1; transition: width 0.1s linear; border-radius: 5px; }
        #loading-text { color: #a6e3a1; margin-top: 10px; font-size: 0.9em; height: 20px; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="bot-required-overlay">
        <p>Please Enable DPbot Extension</p>
        <p style="font-size: 16px; color: #a6adc8; font-weight: normal;">(And allow access to file URLs)</p>
    </div>
    <div id="loadingCaptcha"><div class="spinner"></div><p style="font-size: 0.8em; margin-top: 20px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤ 3D...</p></div>
    <div class="main-container" style="display: none;">
        <div class="step-card">
            <div id="step-area">
                <div id="page-register" class="page active">
                    <h2>‡πÑ‡∏õ‡∏Å‡∏±‡∏ô‡∏ï‡πà‡∏≠</h2><p style="color: #a6adc8;">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß</p>
                    <div class="countdown-container"><span id="countdown"></span></div>
                    <button class="register" id="registerBtn" disabled>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                </div>
                <div id="page-success" class="page">
                    <h2 style="color:#a6e3a1;">üéâ Booking Success!</h2>
                    <button id="resetBtn">‡∏à‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                </div>
            </div>
        </div>
    </div>
    <div id="captchaModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top:0; color: #fab387;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</h2>
            <p style="color: #a6adc8;">‡∏´‡∏°‡∏∏‡∏ô‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</p>
            <div class="scene">
                <canvas id="captcha-canvas"></canvas>
                <div id="object3d">
                    <div class="face front"><img src="my_character.png" alt="CAPTCHA Image"></div>
                </div>
            </div>
            <div id="captcha-status"></div>
            <div id="loading-text" style="display: none;">‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...</div>
        </div>
    </div>

    <script>
        const registerBtn = document.getElementById("registerBtn");
        const resetBtn = document.getElementById("resetBtn");
        const captchaModal = document.getElementById('captchaModal');
        const canvas = document.getElementById('captcha-canvas');
        const object3d = document.getElementById('object3d');
        const captchaStatus = document.getElementById('captcha-status');
        const loadingText = document.getElementById('loading-text');
        let isDragging = false, lastX, lastY, currentXAngle = 0, currentYAngle = 0;

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId)?.classList.add('active');
        }
        function setInitialRotation() {
            currentYAngle = 120 + (Math.random() * 120 - 60);
            currentXAngle = Math.random() * 40 - 20;
            object3d.style.transition = 'none';
            object3d.style.transform = `rotateX(${currentXAngle}deg) rotateY(${currentYAngle}deg)`;
        }
        function openCaptchaModal() {
            const loadingCaptcha = document.getElementById('loadingCaptcha');
            loadingCaptcha.style.display = 'flex';
            setInitialRotation();
            captchaStatus.textContent = '';
            captchaStatus.className = '';
            loadingText.style.display = 'none';
            setTimeout(() => {
                loadingCaptcha.style.display = 'none';
                captchaModal.style.display = 'flex';
            }, 1500);
        }
        function checkRotation() {
            const normalizedY = ((currentYAngle % 360) + 540) % 360 - 180;
            const normalizedX = ((currentXAngle % 360) + 540) % 360 - 180;
            const tolerance = 25;
            if (Math.abs(normalizedY) <= tolerance && Math.abs(normalizedX) <= tolerance) {
                captchaStatus.textContent = '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô!';
                captchaStatus.className = 'success';
                loadingText.style.display = 'block';
                setTimeout(() => {
                    captchaModal.style.display = 'none';
                    showPage('page-success');
                }, 2000);
            } else {
                captchaStatus.textContent = '‚ùå ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                captchaStatus.className = 'failure';
            }
        }
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            object3d.style.transition = 'none';
        });
        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const deltaX = e.clientX - lastX;
            const deltaY = e.clientY - lastY;
            currentYAngle += deltaX * 0.5;
            currentXAngle -= deltaY * 0.5;
            lastX = e.clientX;
            lastY = e.clientY;
            object3d.style.transform = `rotateX(${currentXAngle}deg) rotateY(${currentYAngle}deg)`;
        });
        document.addEventListener('mouseup', () => {
            if (!isDragging) return;
            isDragging = false;
            object3d.style.transition = 'transform 0.4s ease';
            checkRotation();
        });
        function startCountdown() {
            const countdownEl = document.getElementById("countdown");
            const registerBtn = document.getElementById("registerBtn");
            let secondsLeft = 5;
            registerBtn.disabled = true;
            countdownEl.style.display = 'block';
            countdownEl.textContent = `‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô ${secondsLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
            const timer = setInterval(() => {
                secondsLeft--;
                if (secondsLeft <= 0) {
                    clearInterval(timer);
                    countdownEl.style.display = 'none';
                    registerBtn.disabled = false;
                } else {
                    countdownEl.textContent = `‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô ${secondsLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                }
            }, 1000);
        }
        function initializePage() {
            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡∏£‡∏≠‡πÉ‡∏´‡πâ content.js ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ attribute ‡∏Å‡πà‡∏≠‡∏ô
            // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏´‡πâ content.js ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏™‡∏î‡∏á .main-container ‡πÄ‡∏≠‡∏á
            setTimeout(() => {
                if (document.body.dataset.dpbotEnabled !== 'true') {
                    document.getElementById('bot-required-overlay').style.display = 'flex';
                    document.querySelector('.main-container').style.display = 'none';
                } else {
                    document.getElementById('bot-required-overlay').style.display = 'none';
                    document.querySelector('.main-container').style.display = 'block';
                    showPage('page-register');
                }
            }, 500); // ‡∏£‡∏≠ 500ms ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ content.js ‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
        }
        registerBtn.addEventListener("click", openCaptchaModal);
        resetBtn.addEventListener("click", () => showPage('page-register'));
        document.addEventListener("DOMContentLoaded", initializePage);
    </script>
</body>
</html>