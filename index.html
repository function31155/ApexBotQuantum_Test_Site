<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web Test Booking DPbot</title>
    <style>
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #1e1e2e; margin: 0; font-family: 'Poppins', sans-serif; padding: 20px; user-select: none; }
        .main-container, .step-card { width: 100%; max-width: 420px; }
        .step-card { background: #2a2a3a; border-radius: 12px; padding: 25px; color: white; text-align: center; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); border: 1px solid #4c4c6a; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s ease; }
        button { border-radius: 8px; border: none; padding: 12px 18px; font-weight: bold; cursor: pointer; transition: all 0.2s ease; font-family: 'Poppins', sans-serif; font-size: 1rem; }
        button:disabled { cursor: not-allowed; opacity: 0.5; }
        button.register { color: #fff; background: linear-gradient(45deg, #5e72e4, #825ee4); }
        button.register:not(:disabled):hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(94, 114, 228, 0.4); }
        button.next-btn { background-color: #888; color: #ccc; }
        button.next-btn.enabled { background-color: #28a745; color: white; opacity: 1; }
        .summary-info { background-color: #1e293b; color: #cbd5e1; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left; border: 1px solid #4a5568; }
        .summary-info h3 { color: #e2e8f0; margin-top: 0; }
        .summary-info span { color: #a6e3a1; font-weight: bold; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background-color: #2a2a3a; color: white; padding: 24px; border-radius: 16px; width: 90%; max-width: 420px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); position: relative; border: 1px solid #4c4c6a; }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 12px; display: block; text-align: center; color: #a6adc8; }
        .modal .close { position: absolute; top: 12px; right: 16px; font-size: 24px; color: #718096; cursor: pointer; }
        .branchButtons { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        #branchList .branch-item { background: #334155; color: #a0aec0; }
        #branchList .branch-item.selected { background-color: #22c55e; color: white; }
        #cloudflare-simulation { display:none; align-items: center; justify-content: center; padding: 20px; background-color: #2d3748; border-radius: 8px; margin: 20px 0; }
        .spinner { width: 24px; height: 24px; border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: #89b4fa; border-radius: 50%; animation: spin 1s linear infinite; }
        #bot-required-overlay { display: none; align-items: center; justify-content: center; color: #f56565; font-size: 24px; font-weight: bold; text-align: center; }
        .scene { width: 250px; height: 250px; perspective: 1200px; margin: 20px auto; position: relative; }
        canvas { width: 100%; height: 100%; cursor: grab; position: absolute; top:0; left:0; }
        canvas:active { cursor: grabbing; }
        #object3d { width: 100%; height: 100%; position: absolute; top: 0; left: 0; transform-style: preserve-3d; pointer-events: none; }
        .face { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; border-radius: 10px; overflow: hidden; backface-visibility: hidden; }
        .front img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
        #captcha-status { margin-top: 15px; font-size: 1.2em; font-weight: bold; height: 30px; transition: color 0.5s ease; }
        .success { color: #a6e3a1; }
        .failure { color: #f38ba8; }
        .loading-bar-container { width: 80%; margin: 15px auto 0; background-color: #4c4c6a; border-radius: 5px; height: 8px; overflow: hidden; }
        .loading-bar { width: 0%; height: 100%; background-color: var(--accent-green); transition: width 0.1s linear; border-radius: 5px; }
        #loading-text { color: var(--accent-green); margin-top: 10px; font-size: 0.9em; height: 20px; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="bot-required-overlay">Please Enable DPbot Extension</div>

    <div class="main-container">
        <div class="step-card">
            <div id="step-area">
                <div id="page-register" class="page active">
                    <h2>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
                    <p style="color: #a6adc8; font-size: 0.9em;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏Ñ‡∏õ‡∏ä‡πà‡∏≤ 3D</p>
                    <button class="register enabled" id="registerBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                </div>
                <div id="page-success" class="page">
                    <h2 style="color:#a6e3a1;">üéâ Booking Success!</h2>
                    <div class="summary-info">
                        <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                        <p>‡∏™‡∏≤‡∏Ç‡∏≤: <span id="final-summary-branch"></span></p>
                        <p>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: <span id="final-summary-time-taken"></span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                    </div>
                    <button id="resetBtn">‡∏à‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <div id="captchaModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top:0; color: #fab387;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</h2>
            <p style="color: #a6adc8;">‡∏´‡∏°‡∏∏‡∏ô‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</p>
            <div class="scene">
                <canvas id="captcha-canvas"></canvas>
                <div id="object3d">
                    <div class="face front">
                        <img src="my_character.png" alt="CAPTCHA Image">
                    </div>
                </div>
            </div>
            <div id="captcha-status"></div>
            <div class="loading-bar-container" style="display: none;" id="loading-bar-container">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
            <div id="loading-text" style="display: none;">‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script>
        const registerBtn = document.getElementById('registerBtn');
        const resetBtn = document.getElementById('resetBtn');
        const captchaModal = document.getElementById('captchaModal');
        const canvas = document.getElementById('captcha-canvas');
        const object3d = document.getElementById('object3d');
        const captchaStatus = document.getElementById('captcha-status');
        const loadingText = document.getElementById('loading-text');
        const loadingBarContainer = document.getElementById('loading-bar-container');
        const loadingBar = document.getElementById('loading-bar');

        let isDragging = false;
        let lastX, lastY;
        let currentXAngle = 0;
        let currentYAngle = 0;
        let startTime;

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId)?.classList.add('active');
        }

        function setInitialRotation() {
            currentYAngle = 120 + (Math.random() * 120 - 60);
            currentXAngle = Math.random() * 40 - 20;
            object3d.style.transition = 'none';
            object3d.style.transform = `rotateX(${currentXAngle}deg) rotateY(${currentYAngle}deg)`;
        }

        function openCaptchaModal() {
            startTime = new Date();
            setInitialRotation();
            captchaStatus.textContent = '';
            captchaStatus.className = '';
            loadingText.style.display = 'none';
            loadingBarContainer.style.display = 'none';
            captchaModal.style.display = 'flex';
        }

        function checkRotation() {
            const normalizedY = ((currentYAngle % 360) + 540) % 360 - 180;
            const normalizedX = ((currentXAngle % 360) + 540) % 360 - 180;
            const tolerance = 25;

            if (Math.abs(normalizedY) <= tolerance && Math.abs(normalizedX) <= tolerance) {
                captchaStatus.textContent = '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô!';
                captchaStatus.className = 'success';
                loadingText.style.display = 'block';
                loadingBarContainer.style.display = 'block';
                loadingBar.style.width = '0%';
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    loadingBar.style.width = `${progress}%`;
                    if (progress >= 100) clearInterval(interval);
                }, 100);

                setTimeout(() => {
                    captchaModal.style.display = 'none';
                    const endTime = new Date();
                    const elapsedTime = ((endTime - startTime) / 1000).toFixed(2);
                    document.getElementById('final-summary-branch').textContent = "Test Branch";
                    document.getElementById('final-summary-time-taken').textContent = elapsedTime;
                    showPage('page-success');
                    if(typeof confetti === 'function') confetti();
                }, 2000);
            } else {
                captchaStatus.textContent = '‚ùå ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                captchaStatus.className = 'failure';
            }
        }

        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            object3d.style.transition = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const deltaX = e.clientX - lastX;
            const deltaY = e.clientY - lastY;
            currentYAngle += deltaX * 0.5;
            currentXAngle -= deltaY * 0.5;
            lastX = e.clientX;
            lastY = e.clientY;
            object3d.style.transform = `rotateX(${currentXAngle}deg) rotateY(${currentYAngle}deg)`;
        });

        document.addEventListener('mouseup', () => {
            if (!isDragging) return;
            isDragging = false;
            object3d.style.transition = 'transform 0.4s ease';
            checkRotation();
        });

        function initializePage() {
             document.querySelector('.main-container').style.display = 'block';
             document.getElementById('bot-required-overlay').style.display = 'none';
             showPage('page-register');
        }

        registerBtn.addEventListener('click', openCaptchaModal);
        resetBtn.addEventListener('click', () => showPage('page-register'));
        document.addEventListener("DOMContentLoaded", initializePage);

    </script>
</body>
</html>